#!/bin/bash

wall="$(cat "${XDG_CONFIG_HOME:-$HOME/.config}/miner_wallet")"
docker service ps miner >/dev/null 2>&1

if [[ $? -eq 1 ]]; then
    docker service create --mode=global \
  --name miner cpu-opt:latest ./cpuminer \
  -a cryptonight \
  -o stratum+tcp://cryptonight.pl.nicehash.com:3355 \
  -u "$wall".miner1
else
    docker service scale miner=1
fi

docker service logs -f miner
